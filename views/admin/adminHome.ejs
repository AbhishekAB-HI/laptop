<!DOCTYPE HTML>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>TrendHub Dashboard</title>
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title" content="">
    <meta property="og:type" content="">
    <meta property="og:url" content="">
    <meta property="og:image" content="">
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="/admin/assets/imgs/theme/favicon.svg">
    <!-- Template CSS -->
    <link href="/admin/assets/css/main.css" rel="stylesheet" type="text/css" />
</head>

<body>
    <!-- <div class="screen-overlay"></div> -->



    <!-- nav bar side -->



    <%- include("../layout/Adminbar.ejs")%>




        <!-- nav bar side -->
        <main class="main-wrap">
            <header class="main-header navbar">

                <div class="col-nav">
                    <button class="btn btn-icon btn-mobile me-auto" data-trigger="#offcanvas_aside"> <i
                            class="material-icons md-apps"></i> </button>
                    <ul class="nav">


                    </ul>
                </div>
            </header>
            <section class="content-main">
                <div class="content-header">
                    <div>
                        <h2 class="content-title card-title">Dashboard </h2>
                        <p>Whole data about your business here</p>
                    </div>
                    <!-- <div>
                    <a href="#" class="btn btn-primary"><i class="text-muted material-icons md-post_add"></i>Create report</a>
                </div> -->
                </div>
                <div class="row">
                    <div class="col-lg-3">
                        <div class="card card-body mb-4">
                            <article class="icontext">
                                <span class="icon icon-sm rounded-circle bg-primary-light"><i
                                        class="text-primary material-icons md-monetization_on"></i></span>
                                <div class="text">
                                    <h6 class="mb-1 card-title">Revenue</h6>
                                    <% revenue.forEach(item=> { %>
                                        <span>₹<%= item.revenue %></span>
                                        <% }); %>



                                            <span class="text-sm">
                                                Shipping fees are not included
                                            </span>
                                </div>
                            </article>
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <div class="card card-body mb-4">
                            <article class="icontext">
                                <span class="icon icon-sm rounded-circle bg-success-light"><i
                                        class="text-success material-icons md-local_shipping"></i></span>
                                <div class="text">
                                    <h6 class="mb-1 card-title">Orders</h6> <span>
                                        <%=totalorders%>
                                    </span>
                                    <span class="text-sm">
                                        Excluding orders in transit
                                    </span>
                                </div>
                            </article>
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <div class="card card-body mb-4">
                            <article class="icontext">
                                <span class="icon icon-sm rounded-circle bg-warning-light"><i
                                        class="text-warning material-icons md-qr_code"></i></span>
                                <div class="text">
                                    <h6 class="mb-1 card-title">Products</h6> <span>
                                        <%=totalproducts%>
                                    </span>
                                    <span class="text-sm">
                                        In 19 Categories
                                    </span>
                                </div>
                            </article>
                        </div>
                    </div>
                    <!-- <div class="col-lg-3">
                        <div class="card card-body mb-4">
                            <article class="icontext">
                                <span class="icon icon-sm rounded-circle bg-info-light"><i
                                        class="text-info material-icons md-shopping_basket"></i></span>
                                <div class="text">
                                    <h6 class="mb-1 card-title">Monthly Earning</h6>
                                    <% monthlyrevenue.forEach(item=> { %>
                                        <span>₹<%= item.monthlyrevenue %></span>
                                        <% }); %>

                                            <span class="text-sm">
                                                Based in your local time.
                                            </span>
                                </div>
                            </article>
                        </div>
                    </div> -->
                </div>
                <div class="row">
                    <div class="col-xl-8 col-lg-12">
                        <div class="card mb-4">
                            <article class="card-body">

                               
                                <h5 class="card-title">Sale statistics</h5>
                                <div>
                                   
                                    <select id="dashboardID" name="DashboardID" style="width: 20%;" class="form-select" aria-label="Default select example">
                                        <!-- <option value="Daily">Daily</option>
                                        <option value="Weekly">Weekly</option> -->
                                        <option value="Monthly">Monthly</option>
                                        <option value="Yearly">Yearly</option>
                                    </select>


                                    <!-- <button style="background-color: black;color: white;border-radius: 5px;"  ><a style="text-decoration: none;color: white;" href="/admin/home">Monthly</a> </button>
                                <button style="background-color: black;color: white;border-radius: 5px;margin-left: 5%;"  ><a style="text-decoration: none;color: white;" href="/admin/weekly"> Yearly</a> </button>
                                <button style="background-color: black;color: white;margin-left: 5%;border-radius: 5px;"   ><a style="text-decoration: none;color: white;" href="/admin/weekly">Daily</a></button> -->
                                </div>
                                <canvas id="myChart" height="120px"></canvas>
                                <canvas id="ChartPage" height="120px"></canvas>
                            </article>
                        </div>




                        <div class="row">
                            <div class="col-lg-5">
                                <div class="card mb-4">
                                    <article class="card-body">
                                        <h5 class="card-title">
                                            Top Selling Products
                                            <span class=" rounded-circle"
                                                style="color: rgb(248, 248, 242); background-color: rgb(68, 122, 146); border-radius: 40%; padding: 10px; font-size: 20px;">
                                                <%=BestSellingProductsCount%>
                                            </span>
                                        </h5>
                                        <div class="new-member-list">
                                            <% FindBestSellingProducts.forEach((product, i)=> { %>
                                                <div class="d-flex align-items-center justify-content-between mb-4"
                                                    style="max-width: 300px;">
                                                    <div class="d-flex align-items-center">
                                                        <img src="/productImages/<%= product.images[0] %>" alt=""
                                                            class="avatar">
                                                        <div class="ml-3">
                                                            <h7>
                                                                <%= product.productname %>
                                                            </h7>
                                                            <p class="text-muted font-xs">
                                                                <strong>
                                                                    <%= product.productprice %>
                                                                </strong>
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <% }) %>
                                        </div>
                                    </article>
                                </div>
                            </div>

                            <div class="col-lg-5">
                                <div class="card mb-4">
                                    <article class="card-body">
                                        <h5 class="card-title">
                                            Top Selling Category
                                            <span class=" rounded-circle"
                                                style="color: rgb(248, 248, 242); background-color: rgb(68, 122, 146); border-radius: 40%; padding: 10px; font-size: 20px;">
                                                <%=cataSize%>
                                            </span>
                                        </h5>
                                        <div class="new-member-list">
                                            <% uniqueCategories.forEach((category, i)=> { %>
                                                <div class="d-flex align-items-center justify-content-between mb-4"
                                                    style="max-width: 300px;">
                                                    <div class="d-flex align-items-center">
                                                        <div class="ml-3">
                                                            <h7 class="p-1"
                                                                style="background-color: rgb(57, 141, 214);color: rgb(241, 233, 233);border-radius: 5px;">
                                                                <%= category %></strong>
                                                            </h7>
                                                            <p class="text-muted font-xs">
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <% }) %>
                                        </div>
                                    </article>
                                </div>
                            </div>


                        </div>

                    </div>
                    <div class="col-xl-4 col-lg-12">
                        <div class="card mb-4">
                            <article class="card-body">
                                <h5 class="card-title">Revenue Base on Area</h5>
                                <canvas id="myChart2" height="217"></canvas>
                            </article>
                        </div>
                        <div class="col-lg-10">
                            <div class="card mb-4">
                                <article class="card-body">
                                    <h5 class="card-title">
                                        Top Selling Brand
                                        <span class=" rounded-circle"
                                            style="color: rgb(248, 248, 242); background-color: rgb(68, 122, 146); border-radius: 40%; padding: 10px; font-size: 20px;">
                                            <%=brandCount%>
                                        </span>
                                    </h5>
                                    <div class="new-member-list">
                                        <% brandNamearray.forEach((product, i)=> { %>
                                            <div class="d-flex align-items-center justify-content-between mb-4"
                                                style="max-width: 300px;">
                                                <div class="d-flex align-items-center">
                                                    <div class="ml-3">
                                                        <h7 class="p-1"
                                                            style="background-color: rgb(68, 122, 146);color: rgb(241, 233, 233);border-radius: 5px;">
                                                            <%= product %></strong>
                                                        </h7>
                                                        <p class="text-muted font-xs">
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                            <% }) %>
                                    </div>
                                </article>
                            </div>
                        </div>
                        <!-- <div class="card mb-4">
                        <article class="card-body">
                            <h5 class="card-title">Marketing Chanel</h5>
                            <span class="text-muted font-xs">Facebook</span>
                            <div class="progress mb-3">
                                <div class="progress-bar" role="progressbar" style="width: 15%">15%</div>
                            </div>
                            <span class="text-muted font-xs">Instagram</span>
                            <div class="progress mb-3">
                                <div class="progress-bar" role="progressbar" style="width: 65%">65% </div>
                            </div>
                            <span class="text-muted font-xs">Google</span>
                            <div class="progress mb-3">
                                <div class="progress-bar" role="progressbar" style="width: 51%"> 51% </div>
                            </div>
                            <span class="text-muted font-xs">Twitter</span>
                            <div class="progress mb-3">
                                <div class="progress-bar" role="progressbar" style="width: 80%"> 80%</div>
                            </div>
                            <span class="text-muted font-xs">Other</span>
                            <div class="progress mb-3">
                                <div class="progress-bar" role="progressbar" style="width: 80%"> 80%</div>
                            </div>
                        </article>
                    </div> -->
                    </div>
                </div>
                <h3 style="color: black;background-color:rgb(172, 204, 233);">Ledger book</h3>

                <table class="table">
                    <thead style="color: black;background-color:  aliceblue;">
                        <tr>
                            <th scope="col">No</th>
                            <th scope="col">OrderID</th>
                            <th scope="col">Transactions</th>
                            <th scope="col">Date</th>
                            <th scope="col">Status</th>
                            <th scope="col">Debit</th>
                            <th scope="col">Credit</th>
                            <th scope="col">Total Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>

                            <% orderDetails.forEach((order,i)=>{%>

                                <%order.products.forEach((item,j)=>{%>

                                    <th scope="row">
                                        <%=i+1+j%>
                                    </th>
                                    <td>
                                        <%=order._id%>
                                    </td>
                                    <td>
                                        <%=item.paymentMethod%>
                                    </td>
                                    <td>
                                        <%=order.createdAt.toLocaleDateString()%>
                                    </td>
                                    <td>
                                        <%=item.status%>
                                    </td>

                                    <%if(item.status=="returnApproved"){%>


                                        <td style="color: red;">-<%=order.subtotal%>
                                        </td>

                                        <%}else{%>
                                            <td>0</td>
                                            <%}%>

                                                <%if(item.status=="returnApproved"){%>

                                                    <td>0</td>

                                                    <%}else{%>

                                                        <td style="color: rgb(27, 117, 13);">+<%=order.subtotal%>
                                                        </td>
                                                        <%}%>


                                                            <td>
                                                                <%=order.subtotal%>
                                                            </td>
                        </tr>
                        <%})%>

                            <%})%>



                    </tbody>
                </table>
                <div class="text-center">

                    <% for(let j=1;j<=totalpages;j++){ %>

                        <a class="text-black" style="text-decoration: none;" href="?page=<%=j%>"><button
                                class="btn btn-light">
                                <%= j %>
                            </button></a>
                        <% } %>


                </div>



            </section> <!-- content-main end// -->
            <footer class="main-footer font-xs">
                <div class="row pb-30 pt-15">
                    <div class="col-sm-6">
                        <script>
                            document.write(new Date().getFullYear())
                        </script> ©, Evara - HTML Ecommerce Template .
                    </div>
                    <div class="col-sm-6">
                        <div class="text-sm-end">
                            All rights reserved
                        </div>
                    </div>
                </div>
            </footer>
        </main>
        <script src="assets/js/vendors/jquery-3.6.0.min.js"></script>
        <script src="assets/js/vendors/bootstrap.bundle.min.js"></script>
        <script src="assets/js/vendors/select2.min.js"></script>
        <script src="assets/js/vendors/perfect-scrollbar.js"></script>
        <script src="assets/js/vendors/jquery.fullscreen.min.js"></script>
        <script src="assets/js/vendors/chart.js"></script>
        <!-- Main Script -->
        <script src="assets/js/main.js" type="text/javascript"></script>
        <!-- <script src="assets/js/custom-chart.js" type="text/javascript"></script> -->

        

        <script>

                (function ($) {
                    "use strict";
                    /*Sale statistics Chart*/
                    if ($('#myChart').length) {
                        var ctx = document.getElementById('myChart').getContext('2d');
                       var chart = new Chart(ctx, {
                            // The type of chart we want to create
                            type: 'line',

                            // The data for our dataset
                            data: {
                                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                                datasets: [{
                                    label: 'MonthlySales',
                                    tension: 0.3,
                                    fill: true,
                                    backgroundColor: 'rgba(44, 120, 220, 0.2)',
                                    borderColor: 'rgba(44, 120, 220)',
                                    data: <%=JSON.stringify(graphValue) %>
                            },


                                ]
                            },
                            options: {
                                plugins: {
                                    legend: {
                                        labels: {
                                            usePointStyle: true,
                                        },
                                    }
                                }
                            }
                        });



                        function ChartFunction(value) {
                var labels = [];
                var dataValues = [];

                if (value === 'Daily') {
                    // Handle daily data
                    // Populate 'labels' and 'dataValues' arrays with your daily data
                } else if (value === 'Weekly') {
               
                    // Handle weekly data
                    // Populate 'labels' and 'dataValues' arrays with your weekly data
                } else if (value === 'Monthly') {
                    labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                    dataValues = <%=JSON.stringify(graphValue) %>;
                } else if (value === 'Yearly') {
                    labels = ['2020', '2021', '2022', '2023', '2024', '2025'];
                    dataValues = <%=JSON.stringify(yearArray) %>;
                }

                var newData = {
                    labels: labels,
                    datasets: [{
                        label: value,
                        tension: 0.3,
                        fill: true,
                        backgroundColor: 'rgba(44, 120, 220, 0.2)',
                        borderColor: 'rgba(44, 120, 220)',
                        data: dataValues,
                    }],
                };

                chart.data = newData;
                chart.update();
            }




document.getElementById('dashboardID').addEventListener('change', function() {
var selectedInterval = this.value;

ChartFunction(selectedInterval)

});

                    }
                


                    /*Sale statistics Chart*/
                    if ($('#myChart2').length) {
                        var ctx = document.getElementById("myChart2");
                        var myChart = new Chart(ctx, {
                            type: 'bar',
                            data: {
                                labels: ['Wallet', 'COD', 'onlinePay'],
                                datasets: [
                                    {
                                        label: "Payment",
                                        backgroundColor: "#5897fb",
                                        barThickness: 10,
                                        data: ['<%=Wallet%>', '<%=cashondelivery%>', '<%=onlinePay%>']
                                    },
                                    
                                ]
                            },
                            options: {
                                plugins: {
                                    legend: {
                                        labels: {
                                            usePointStyle: true,
                                        },
                                    }
                                },
                                scales: {
                                    y: {
                                        beginAtZero: true
                                    }
                                }
                            }
                        });
                    } //end if

                })(jQuery);
        

          





              

        </script>








        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
            crossorigin="anonymous"></script>



        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</body>

</html>