<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
  <meta name="generator" content="Jekyll v3.8.5">
  <title>Checkout example · Bootstrap</title>



  <link rel="canonical" href="https://getbootstrap.com/docs/4.3/examples/checkout/">

  <!-- Bootstrap core CSS -->
  <link href="/docs/4.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

  <link rel="stylesheet" href="/static/checkout.css">

  <style>
    .bd-placeholder-img {
      font-size: 1.125rem;
      text-anchor: middle;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    @media (min-width: 768px) {
      .bd-placeholder-img-lg {
        font-size: 3.5rem;
      }
    }
  </style>
  <!-- Custom styles for this template -->
  <link href="form-validation.css" rel="stylesheet">
</head>
<!-- Header-->
<nav class="navbar navbar-expand-lg  bg-info ">
  <div class="container px-4 px-lg-5">
    <a class="navbar-brand text-white" href="/dashboard">Trend Hub</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span
        class="navbar-toggler-icon"></span></button>
    <nav class="navbar navbar-expand-lg navbar-light bg-info">

      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item active">
            <a class="nav-link text-white" href="/dashboard">Home<span class="sr-only"></span></a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle text-white" href="#" id="navbarDropdown" role="button"
              data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Account
            </a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
              <a class="dropdown-item" href="/aboutus">My profile</a>
              <a class="dropdown-item" href="/logout">logout</a>
          </li>
          <li class="nav-item">
            <a class="nav-link disabled text-white" href="">Contact Us</a>

          </li>
          <li class="nav-item">
            <a class="nav-link  text-white" href="/showCoupons"> Coupons</a>
          </li>
        </ul>
      </div>
    </nav>

    <form class="d-flex">
      <button class="btn btn-outline-dark text-white" type="submit">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
          class="bi bi-cart3 text-white" viewBox="0 0 16 16">
          <path
            d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .49.598l-1 5a.5.5 0 0 1-.465.401l-9.397.472L4.415 11H13a.5.5 0 0 1 0 1H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5M3.102 4l.84 4.479 9.144-.459L13.89 4H3.102zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4m7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4m-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2m7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2" />
        </svg>
        <a class="text-white" style="text-decoration: none; " href="/getProduct">My cart</a>
      </button>
    </form>

  </div>
  </div>
</nav>





<!-- Header-->

<body class="bg-light">
  <div class="container mt-5 mb-5">

    <div class="text-center">
      <% if(typeof message !=="undefined" ){ %>
        <h5 style="color:red;">
          <%= message %>
        </h5>
        <% } %>
    </div>

    <!-- Your cart side -->
    <form id="checkOutForm" method="post">
      <div class="row">
        <div class="col-md-3 order-md-1  mb-4">
          <h4 class="d-flex justify-content-between align-items-center mb-3">
            <span class="text-muted">Your cart</span>
            <span class="badge badge-secondary badge-pill">
              <%=qty%>
            </span>
          </h4>
          <ul class="list-group mb-3">
            <li class="list-group-item d-flex justify-content-between lh-condensed">
              <div>
                <h6 class="my-0">Total number of qunatity</h6>
              </div>
              <span class="text-muted">
                <%=qty%>
              </span>
            </li>
            <li class="list-group-item d-flex justify-content-between lh-condensed">
              <div>
                <h6 class="my-0">Total number of price</h6>

              </div>
              <p>₹<span class="text-muted" id="Totalamounte">
                  <%=totalPrice%>
                </span></p>
            </li>

            <li class="list-group-item d-flex justify-content-between lh-condensed">
              <div>
                <h6 class="my-0">Discount </h6>

              </div>
              <span id="DiscountAmount" class="text-muted">0</span>
            </li>
            <li class="list-group-item d-flex justify-content-between">
              <span>Total (USD)</span>
              <strong>₹</strong><strong id="totalValueIs">
                <%=totalPrice%>
              </strong>
            </li>
          </ul>
          <li class="list-group-item d-flex justify-content-between lh-condensed">

            <input type="text" id="couponcodeInput" name="couponcode"
              style="width: 80px;padding-left: 5px;  height: 30px;margin-right: 4px;">
            <div>
              <button type="button" id="couponcheck" class="ml-4 mb-2"
                style="align-items: center; background-color: black;color:white;border-radius: 5px;width: 100px;height: 25px;">
                <h6 style="font-size: 13px;"  >Apply Coupon</h6>
              </button>
              <button type="button" id="couponRemove" class="ml-4"
              style="align-items: center; background-color: rgb(206, 18, 18);color:white;border-radius: 5px;width: 100px;height: 25px;">
              <h6  style="font-size: 13px;" >Remove</h6>
            </button>
            </div>
          </li>
        </div>
        <!-- Your cart side -->
        <style>
          .table {
            margin-right: 100em;
          }
        </style>
        <!-- payment side -->
        <div class="col-md-8 order-md-1">
          <h4 class="mb-3">Billing address</h4>
          <h4>Your current address :</h4>
          <br>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="address" id="exampleRadios1" value="<%=address%>"
              checked>
            <label class="form-check-label" for="exampleRadios1">
              <h6>
                <%=address%>
              </h6>
            </label>
          </div>
          <br>
          <h4 class="mb-4"><a href="/checkadress">Add address</a></h4>

          <table class="table">
            <thead>
              <tr>
                <th scope="col">No</th>
                <th scope="col">FirstName</th>
                <th scope="col">LastName</th>
                <th scope="col">city</th>
                <th scope="col">Email</th>
                <th scope="col">Address</th>
                <th scope="col">State</th>
                <th scope="col">Select address</th>
              </tr>
            </thead>
            <tbody>
              <td>
                <% if( check.address1.length>0){
                  check.address1.forEach((item,i)=>{
                  %>
                  <tr>
                    <th scope="row">
                      <%=i+1%>
                    </th>
                    <td>
                      <%=item.firstName%>
                    </td>
                    <td>
                      <%=item.lastName%>
                    </td>
                    <td>
                      <%=item.city%>
                    </td>
                    <td>
                      <%=item.email%>
                    </td>
                    <td>
                      <%=item.address%>
                    </td>
                    <td>
                      <%=item.state%>
                    </td>
                    <td><input type="radio" name="address" value="<%=item.address%>"></td>
                  </tr>
                  <% }) }else{ %>
              <td>
                <h5 style="color: red;">No address added</h5>
              </td>
              <% } %>
            </tbody>
          </table>
          <input id="cartitemsdetails" type="hidden" value="<%=userCart%>">
          <hr class="mb-4">
          <hr class="mb-4">
          <h4 class="mb-3">Payment</h4>
          <div class="d-block my-3">
            <div class="custom-control custom-radio">

                    <%if(totalPrice>10000 ){%>

                      <input id="credit" disabled name="paymentMethod" value="cash on delivery" type="radio" class="custom-control-input"
                      checked required>
                  
                  
                    <%}else{%>
                      <input id="credit" name="paymentMethod" value="cash on delivery" type="radio" class="custom-control-input"
                      checked required>
                    <label class="custom-control-label" for="credit">Cash on delivery</label>

                    <%}
                    
                    
                    %>

        
            </div>
            <div class="custom-control custom-radio">
              <input id="debit" name="paymentMethod" value="onlinePay" type="radio" class="custom-control-input"
                required>
              <label class="custom-control-label" for="debit">Online Payment</label>
            </div>
            <%if(totalPrice> check.wallet){%>
              <div class="custom-control custom-radio">
                <input id="paypal" name="paymentMethod" value="Wallet" disabled type="radio"
                  class="custom-control-input" required>
                <label class="custom-control-label" for="paypal">Wallet</label>
              </div>
              <%}else{%>
                <div class="custom-control custom-radio">
                  <input id="paypal" name="paymentMethod" value="Wallet" type="radio" class="custom-control-input"
                    required>
                  <label class="custom-control-label" for="paypal">Wallet</label>
                </div>
                <%}%>
          </div>
          <hr class="mb-4">
          <button type="button" id="isValue" class="btn btn-primary btn-lg btn-block">Place order</button>
    </form>
  </div>
  </div>

  <!-- payment side -->



  </div>
  <%- include("../layout/navbarbottom.ejs")%>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"></script>
    <script>window.jQuery || document.write('<script src="/docs/4.3/assets/js/vendor/jquery-slim.min.js"><\/script>')</script>
    <script src="https://getbootstrap.com/docs/4.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-xrRywqdh3PHs8keKZN+8zzc5TX0GRTLCcmivcbNJWm2rs5C8PRhcEn3czEjhAO9o"
      crossorigin="anonymous"></script>
    <script src="https://getbootstrap.com/docs/4.3/examples/checkout/form-validation.js"></script>

    <script>

      // checkout selection----------------------------------------------------------------------------------
      // ----------------------------------------------------------------------------------------------------------------------------------------------------
      document.getElementById("isValue").addEventListener("click", (event) => {


        event.preventDefault();
        let selectedRadio = document.querySelector('input[name="paymentMethod"]:checked');
        if (selectedRadio.value == "onlinePay") {
          const values = document.getElementById("cartitemsdetails").value
         
          Rayzopaycall(values)
        } else {
          if (selectedRadio.value == "cash on delivery") {
            const values = document.getElementById("cartitemsdetails").value
            cashOnDelivery(values)

          } else {
            const values = document.getElementById("cartitemsdetails").value
            walletcall(values)

          }
        }
      })


      //Rayzopay function----------------------------------------------------------------------------------------------

      async function Rayzopaycall() {

        try {
          const coupondata = document.getElementById("couponcodeInput").value
          const discountValue = document.getElementById("DiscountAmount").textContent;
          const selectedAddress = document.querySelector('input[name="address"]:checked')
          const totalprice = document.getElementById("totalValueIs").textContent
          const res = await fetch("/onlinepayment", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ address: selectedAddress.value, discount: discountValue, coupon: coupondata })
          })
          const result = await res.json();
          const dats = result.orders;

          window.location.href = `/rayzopay?orderid=${result.orderid}&&data=${JSON.stringify(dats)}&&Totalamount=${totalprice}`

        } catch (error) {
          console.log(error);
        }
      }

      // Rayzopay function----------------------------------------------------------------------------------------------

      // wallet function------------------------------------------------------------------
      async function walletcall() {
        const coupondata = document.getElementById("couponcodeInput").value
        const discountValue = document.getElementById("DiscountAmount").textContent;
        const selectedAddress = document.querySelector('input[name="address"]:checked')
        const totalprice = document.getElementById("totalValueIs").textContent
        const responcewallet = await fetch("/walletcheck", {
          method: "post",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ totalprice, address: selectedAddress.value, discount: discountValue, coupon: coupondata })
        });
        if (responcewallet.ok) {
          const responce = await responcewallet.json();
          if (responce.status == true) {
            Swal.fire({
              title: "Order Success",
              text: "Thank you. Continue shopping",
              icon: "success"
            }).then((result) => {
              // Check if the user clicked "OK"
              if (result.isConfirmed) {


                window.location.href = "/dashboard";
              }
            });
          }
          // Continue processing the JSON response
        } else {
          console.error('Error:', responcewallet.statusText);
          // Handle non-OK response status (e.g., server error)
        }
      }

      // wallet function------------------------------------------------------------------

      // cashondeliveryfunction---------------------------------------------------------------------------------
      async function cashOnDelivery(data) {
        const datavalue = data;
        const coupondata = document.getElementById("couponcodeInput").value
        const discountValue = document.getElementById("DiscountAmount").textContent;
        const selectedAddress = document.querySelector('input[name="address"]:checked')
        const totalprice = document.getElementById("totalValueIs").textContent
        const responcewallet = await fetch("/cashowndelivery", {
          method: "post",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ totalprice, address: selectedAddress.value, discount: discountValue, coupon: coupondata })
        })
        if (responcewallet.ok) {
          const responce = await responcewallet.json();
          if (responce.status == true) {
            Swal.fire({
              title: "Order Successfull.continue Shopping",
              text: "Thank you.",
              icon: "success"
            }).then((result) => {
              // Check if the user clicked "OK"
              if (result.isConfirmed) {
                // Redirect to another page


                window.location.href = "/dashboard";
              }
            });
          }
          // Continue processing the JSON response
        } else {
          console.error('Error:', responcewallet.statusText);
          // Handle non-OK response status (e.g., server error)
        }

      }





      // cashondeliveryfunction---------------------------------------------------------------------------------


      // checkout selection----------------------------------------------------------------------------------
      // -----------------------------------------------------------------------------------------------------------------------------------------------------



      // couponfunction--------------------------------------------------------------------------

      document.getElementById("couponcheck").addEventListener("click", (event) => {
        try {
          event.preventDefault();
          const inputvalue = document.getElementById("couponcodeInput").value;
          const inputData = inputvalue.trim()
          const totalvalue = document.getElementById("Totalamounte").textContent;
          if (inputData.length != 0) {
            passingCouponvalue(inputData, totalvalue)
          }
        } catch (error) {
          console.log(error);
        }
      })



      async function passingCouponvalue(name, total) {
        try {

          const getcoupon = await fetch("/passingCopon", {
            method: "post",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name, total })
          })
          const responce = await getcoupon.json();
          if (responce.status == false) {
            showAlertCoupon()
          } else {
            if (responce.message) {
              showPurchaseCoupon(responce.message)
            } else {
              document.getElementById("DiscountAmount").textContent = responce.totalDiscount
              document.getElementById("totalValueIs").textContent = (total - responce.totalDiscount)
            }

          }
        } catch (error) {
          console.log(error);
        }
      }

      // clear coupon --------------------------------------------------------------------------

      document.getElementById("couponRemove").addEventListener("click",(event)=>{
              const totalvalue = '<%=totalPrice%>' 

        event.preventDefault();
        document.getElementById("DiscountAmount").textContent = 0
        document.getElementById("totalValueIs").textContent =totalvalue
        document.getElementById("couponcodeInput").value = "";
      })

      // couponfunction-------------------------------------------------------------------------- 


      // Alert swal----------------------------------------------------------------------------------------------------
      function showAlertCoupon() {
        Swal.fire({
          icon: "error",
          text: "Please input valid coupon",
          confirmButtonColor: '#3085d6',
          cancelButtonColor: '#d33',
        }).then((result) => {
          if (result.isConfirmed) {
          } else {
            console.log('User clicked Go Back');
          }
        });
      }
      function showPurchaseCoupon(amount) {
        Swal.fire({
          icon: "error",
          text: amount,
          confirmButtonColor: '#3085d6',
          cancelButtonColor: '#d33',
        }).then((result) => {
          if (result.isConfirmed) {
            // If "Go to Cart" is clicked, redirect to /cart
            // window.location.href = '/dashboard';
          } else {
            // If "Go Back" is clicked, handle as needed
            console.log('User clicked Go Back');
          }
        });
      }
      // Alert swal----------------------------------------------------------------------------------------------------
    </script>

</body>

</html>